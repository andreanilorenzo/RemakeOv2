VERSION 5.00
Object = "{831FDD16-0C5C-11D2-A9FC-0000F8754DA1}#2.0#0"; "Mscomctl.ocx"
Begin VB.Form frmImporta 
   Caption         =   "frmImporta"
   ClientHeight    =   5475
   ClientLeft      =   60
   ClientTop       =   450
   ClientWidth     =   11745
   Icon            =   "frmImporta.frx":0000
   LinkTopic       =   "Form1"
   ScaleHeight     =   5475
   ScaleWidth      =   11745
   StartUpPosition =   3  'Windows Default
   Begin VB.TextBox txtPreview 
      Height          =   1575
      Left            =   5280
      Locked          =   -1  'True
      MultiLine       =   -1  'True
      ScrollBars      =   3  'Both
      TabIndex        =   16
      Text            =   "frmImporta.frx":030A
      Top             =   1080
      Width           =   2175
   End
   Begin MSComctlLib.ImageList imglRunSearch 
      Left            =   720
      Top             =   720
      _ExtentX        =   1005
      _ExtentY        =   1005
      BackColor       =   -2147483643
      ImageWidth      =   16
      ImageHeight     =   16
      MaskColor       =   12632256
      _Version        =   393216
      BeginProperty Images {2C247F25-8591-11D1-B16A-00C0F0283628} 
         NumListImages   =   61
         BeginProperty ListImage1 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmImporta.frx":0317
            Key             =   ""
         EndProperty
         BeginProperty ListImage2 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmImporta.frx":0631
            Key             =   ""
         EndProperty
         BeginProperty ListImage3 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmImporta.frx":094B
            Key             =   ""
         EndProperty
         BeginProperty ListImage4 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmImporta.frx":30FD
            Key             =   ""
         EndProperty
         BeginProperty ListImage5 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmImporta.frx":4E07
            Key             =   ""
         EndProperty
         BeginProperty ListImage6 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmImporta.frx":5121
            Key             =   ""
         EndProperty
         BeginProperty ListImage7 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmImporta.frx":527B
            Key             =   ""
         EndProperty
         BeginProperty ListImage8 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmImporta.frx":53D5
            Key             =   ""
         EndProperty
         BeginProperty ListImage9 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmImporta.frx":552F
            Key             =   ""
         EndProperty
         BeginProperty ListImage10 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmImporta.frx":5849
            Key             =   ""
         EndProperty
         BeginProperty ListImage11 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmImporta.frx":669B
            Key             =   ""
         EndProperty
         BeginProperty ListImage12 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmImporta.frx":74ED
            Key             =   ""
         EndProperty
         BeginProperty ListImage13 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmImporta.frx":8397
            Key             =   ""
         EndProperty
         BeginProperty ListImage14 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmImporta.frx":91E9
            Key             =   ""
         EndProperty
         BeginProperty ListImage15 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmImporta.frx":B99B
            Key             =   ""
         EndProperty
         BeginProperty ListImage16 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmImporta.frx":BCB5
            Key             =   ""
         EndProperty
         BeginProperty ListImage17 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmImporta.frx":CB07
            Key             =   ""
         EndProperty
         BeginProperty ListImage18 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmImporta.frx":CE21
            Key             =   ""
         EndProperty
         BeginProperty ListImage19 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmImporta.frx":E47B
            Key             =   ""
         EndProperty
         BeginProperty ListImage20 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmImporta.frx":E795
            Key             =   ""
         EndProperty
         BeginProperty ListImage21 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmImporta.frx":EAAF
            Key             =   ""
         EndProperty
         BeginProperty ListImage22 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmImporta.frx":EDC9
            Key             =   ""
         EndProperty
         BeginProperty ListImage23 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmImporta.frx":F0E3
            Key             =   ""
         EndProperty
         BeginProperty ListImage24 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmImporta.frx":F9BD
            Key             =   ""
         EndProperty
         BeginProperty ListImage25 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmImporta.frx":10297
            Key             =   ""
         EndProperty
         BeginProperty ListImage26 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmImporta.frx":110E9
            Key             =   ""
         EndProperty
         BeginProperty ListImage27 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmImporta.frx":11F3B
            Key             =   ""
         EndProperty
         BeginProperty ListImage28 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmImporta.frx":12D8D
            Key             =   ""
         EndProperty
         BeginProperty ListImage29 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmImporta.frx":13667
            Key             =   ""
         EndProperty
         BeginProperty ListImage30 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmImporta.frx":144B9
            Key             =   ""
         EndProperty
         BeginProperty ListImage31 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmImporta.frx":161C3
            Key             =   ""
         EndProperty
         BeginProperty ListImage32 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmImporta.frx":164DD
            Key             =   ""
         EndProperty
         BeginProperty ListImage33 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmImporta.frx":1732F
            Key             =   ""
         EndProperty
         BeginProperty ListImage34 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmImporta.frx":19AE1
            Key             =   ""
         EndProperty
         BeginProperty ListImage35 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmImporta.frx":1C293
            Key             =   ""
         EndProperty
         BeginProperty ListImage36 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmImporta.frx":1DF9D
            Key             =   ""
         EndProperty
         BeginProperty ListImage37 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmImporta.frx":2074F
            Key             =   ""
         EndProperty
         BeginProperty ListImage38 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmImporta.frx":22459
            Key             =   ""
         EndProperty
         BeginProperty ListImage39 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmImporta.frx":22D33
            Key             =   ""
         EndProperty
         BeginProperty ListImage40 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmImporta.frx":23B85
            Key             =   ""
         EndProperty
         BeginProperty ListImage41 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmImporta.frx":251DF
            Key             =   ""
         EndProperty
         BeginProperty ListImage42 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmImporta.frx":25AB9
            Key             =   ""
         EndProperty
         BeginProperty ListImage43 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmImporta.frx":26393
            Key             =   ""
         EndProperty
         BeginProperty ListImage44 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmImporta.frx":271E5
            Key             =   ""
         EndProperty
         BeginProperty ListImage45 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmImporta.frx":2883F
            Key             =   ""
         EndProperty
         BeginProperty ListImage46 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmImporta.frx":29691
            Key             =   ""
         EndProperty
         BeginProperty ListImage47 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmImporta.frx":299AB
            Key             =   ""
         EndProperty
         BeginProperty ListImage48 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmImporta.frx":2A285
            Key             =   ""
         EndProperty
         BeginProperty ListImage49 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmImporta.frx":2A59F
            Key             =   ""
         EndProperty
         BeginProperty ListImage50 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmImporta.frx":2A8B9
            Key             =   ""
         EndProperty
         BeginProperty ListImage51 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmImporta.frx":2ABD3
            Key             =   ""
         EndProperty
         BeginProperty ListImage52 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmImporta.frx":2AD2D
            Key             =   ""
         EndProperty
         BeginProperty ListImage53 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmImporta.frx":2B047
            Key             =   ""
         EndProperty
         BeginProperty ListImage54 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmImporta.frx":2B361
            Key             =   ""
         EndProperty
         BeginProperty ListImage55 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmImporta.frx":2B67B
            Key             =   ""
         EndProperty
         BeginProperty ListImage56 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmImporta.frx":2B995
            Key             =   ""
         EndProperty
         BeginProperty ListImage57 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmImporta.frx":2BCAF
            Key             =   ""
         EndProperty
         BeginProperty ListImage58 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmImporta.frx":2BFC9
            Key             =   ""
         EndProperty
         BeginProperty ListImage59 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmImporta.frx":2C123
            Key             =   ""
         EndProperty
         BeginProperty ListImage60 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmImporta.frx":2C27D
            Key             =   ""
         EndProperty
         BeginProperty ListImage61 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmImporta.frx":2C3D7
            Key             =   ""
         EndProperty
      EndProperty
   End
   Begin VB.PictureBox Picture1 
      Appearance      =   0  'Flat
      BackColor       =   &H80000005&
      BeginProperty Font 
         Name            =   "Arial"
         Size            =   8.25
         Charset         =   0
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   &H80000008&
      Height          =   1020
      Left            =   1920
      ScaleHeight     =   990
      ScaleWidth      =   2295
      TabIndex        =   1
      Top             =   360
      Visible         =   0   'False
      Width           =   2325
   End
   Begin MSComctlLib.ListView ListView1 
      Height          =   3315
      Left            =   0
      TabIndex        =   0
      Top             =   0
      Width           =   11700
      _ExtentX        =   20638
      _ExtentY        =   5847
      View            =   2
      LabelWrap       =   0   'False
      HideSelection   =   0   'False
      OLEDragMode     =   1
      OLEDropMode     =   1
      Checkboxes      =   -1  'True
      _Version        =   393217
      ForeColor       =   -2147483640
      BackColor       =   16777215
      Appearance      =   1
      BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
         Name            =   "MS Sans Serif"
         Size            =   9.75
         Charset         =   0
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      OLEDragMode     =   1
      OLEDropMode     =   1
      NumItems        =   0
   End
   Begin VB.PictureBox pctImpostazioni 
      Appearance      =   0  'Flat
      BorderStyle     =   0  'None
      ForeColor       =   &H80000008&
      Height          =   2055
      Left            =   2280
      ScaleHeight     =   2055
      ScaleWidth      =   7575
      TabIndex        =   2
      Top             =   3360
      Width           =   7575
      Begin VB.TextBox txtCommaSep 
         Alignment       =   2  'Center
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   12
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         Height          =   330
         Left            =   2160
         TabIndex        =   6
         Text            =   "CommaSep"
         Top             =   360
         Width           =   375
      End
      Begin VB.CommandButton cmdLeggiFile 
         Caption         =   "&Leggi il file"
         Height          =   375
         Left            =   6000
         TabIndex        =   14
         Top             =   360
         Width           =   1455
      End
      Begin VB.CheckBox ckNumRiga 
         Caption         =   "Salta la prima &colonna del file .csv"
         Height          =   255
         Left            =   2640
         TabIndex        =   13
         Top             =   120
         Width           =   2895
      End
      Begin VB.Frame Frame 
         Caption         =   " Modifica colonne "
         Height          =   1095
         Left            =   120
         TabIndex        =   8
         Top             =   840
         Width           =   5535
         Begin VB.PictureBox pctFrame1 
            Appearance      =   0  'Flat
            ForeColor       =   &H80000008&
            Height          =   765
            Left            =   120
            ScaleHeight     =   735
            ScaleWidth      =   5265
            TabIndex        =   9
            Top             =   240
            Width           =   5295
            Begin VB.CommandButton cmdSalvaColl 
               Caption         =   "<--------"
               Enabled         =   0   'False
               Height          =   375
               Index           =   1
               Left            =   2160
               TabIndex        =   15
               Top             =   360
               Width           =   855
            End
            Begin VB.CommandButton cmdSalvaColl 
               Caption         =   "<--+-->"
               Enabled         =   0   'False
               Height          =   375
               Index           =   0
               Left            =   2160
               TabIndex        =   10
               Top             =   0
               Width           =   855
            End
            Begin VB.ComboBox cmbCsv 
               Height          =   315
               Left            =   3120
               TabIndex        =   12
               Text            =   "cmbCsv"
               Top             =   240
               Width           =   2055
            End
            Begin VB.ComboBox cmbListView 
               Height          =   315
               Left            =   0
               TabIndex        =   11
               Text            =   "cmbListView"
               Top             =   240
               Width           =   2055
            End
         End
      End
      Begin VB.CommandButton cmdEsci 
         Cancel          =   -1  'True
         Caption         =   "&Esci  [Esc]"
         Height          =   375
         Left            =   6000
         TabIndex        =   7
         Top             =   1560
         Width           =   1455
      End
      Begin VB.CommandButton cmdImporta 
         Caption         =   "&Importa"
         Enabled         =   0   'False
         Height          =   375
         Left            =   6000
         TabIndex        =   5
         Top             =   840
         Width           =   1455
      End
      Begin VB.CheckBox ckIntestazione 
         Caption         =   "Salta la prima &riga del file .csv"
         Height          =   255
         Left            =   120
         TabIndex        =   3
         Top             =   120
         Width           =   2535
      End
      Begin VB.Label lblCommaSep 
         Caption         =   "&Delimitatore di campo:"
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   9.75
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         Height          =   255
         Left            =   120
         TabIndex        =   4
         Top             =   480
         Width           =   2175
      End
   End
End
Attribute VB_Name = "frmImporta"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Option Explicit

Public FormMadre As Form
Public ListViewDest As ListView
Public CancellaListView As Boolean
Public sFileName As String         ' Il nome del file da aprire

Private Sub cmdImporta_Click()
    Dim cnt As Long
    Dim Intestazione As Boolean
    
    If ckIntestazione.Value = 0 Then
        Intestazione = False
    Else
        Intestazione = True
    End If
    
    ' Carico i dati dell'array
    Call CaricaArrayDaListView(ListView1)
    
    ' Cancello dall'array le colonne di troppo
    ReDim Preserve arrListView(UBound(arrListView, 1), ListViewDest.ColumnHeaders.Count - 2)
    
    ' Copio l'array nella listview
    Call CaricaListViewDaArray(ListViewDest, CancellaListView)
    ' Imposto le icone per le righe
    Call ControllaCheck(ListViewDest)
    
    Unload Me
    
End Sub

Private Sub cmdLeggiFile_Click()
    
    If sFileName <> "" Then
        If ListView1.ListItems.Count > 0 Then
            If MsgBox("Procedo alla lettura del file: " & sFileName & "?" & vbNewLine & vbNewLine & "Utilizzando come separatore di campo il carattere " & txtCommaSep.Text, vbInformation + vbYesNo, App.ProductName) = vbNo Then
                GoTo Esci
            End If
        End If
        
        Call CaricaArray(sFileName)
        
    Else
        If MsgBox("Nessun file da aprire." & vbNewLine & "Vuoi selezionare un file da aprire?", vbInformation + vbYesNo, App.ProductName) = vbYes Then
            MsgBox "Funzione non ancora disponibile.", vbInformation, App.ProductName
            sFileName = sFileName
        End If
    End If

Esci:

End Sub

Private Sub cmdEsci_Click()
    Unload Me
End Sub

Private Sub cmdSalvaColl_Click(index As Integer)

    Select Case index
        Case Is = 0
            ' Inverto i dati delle due colonne
            InvertiColonne ListView1, cmbListView.ListIndex + 1, cmbCsv.ListIndex + 1
        
        Case Is = 1
            SommaColonne ListView1, cmbListView.ListIndex + 1, cmbCsv.ListIndex + 1, True
        
    End Select
    
End Sub

Private Sub Form_Load()
    Dim cnt As Long

    If Var(GestioneErrori).Valore = 0 Then On Error GoTo Errore

    Set FormMadre = frmWeb
    
    ' Carico le intestazioni delle colonne nella ComboBox
    For cnt = 2 To ListViewDest.ColumnHeaders.Count
        cmbListView.AddItem ListViewDest.ColumnHeaders(cnt).Text
    Next
    BloccaComboBox cmbListView
    cmbListView.ListIndex = 0
        
    With ListView1
        .AllowColumnReorder = False
        .HideSelection = False
        .MultiSelect = False
        .FullRowSelect = True
        .View = lvwReport
        .LabelEdit = lvwManual ' Evita che si possa editare la prima colonna
        .Icons = imglRunSearch
        .SmallIcons = imglRunSearch
        .ColumnHeaderIcons = imglRunSearch
    End With

    Call SetListViewColor(ListView1, Picture1, 1, vbWhite, vbGreenLemon)

    cmbCsv.Text = ""
    modSalvaColl (False)
    txtCommaSep.Text = Var(CommaSep).Valore
    Me.Caption = "Importazione del file " & NomeFileAperto
    
    pctFrame1.BorderStyle = 0
    
    txtPreview.Text = LeggiFile(sFileName)
    
    Exit Sub

Errore:
    GestErr Err, "Errore nella funzione frmImporta.Form_Load."

End Sub

Private Sub modSalvaColl(ByVal bEnabled As Boolean)
    Dim cnt As Integer
    
    For cnt = 0 To cmdSalvaColl.Count - 1
        cmdSalvaColl(cnt).Enabled = bEnabled
    Next
    
    cmbListView.Enabled = bEnabled
    cmbCsv.Enabled = bEnabled
    
End Sub

Public Sub CaricaArray(FileName As String)
    Dim itmX As ListItem
    Dim cnt As Long
    Dim cntCol As Long
    Dim cntRecord As Long
    Dim CSVP As New cCSVParse
    Dim myArray() As String
    Dim lRows As Long
    Dim lColumns As Long
    Dim strTmp As String
    Dim MaxField As Integer
    Dim MaxRecord As Integer
    
    If Var(GestioneErrori).Valore = 0 Then On Error GoTo Errore
    
    ListView1.ListItems.Clear
    ListView1.ColumnHeaders.Clear
    txtPreview.Visible = False
    
    Screen.MousePointer = vbHourglass
    LockWindowUpdate ListView1.hwnd

    CSVP.FieldSeperator = txtCommaSep.Text
    CSVP.FileName = FileName
    CSVP.SaltaRighe = CInt(ckIntestazione.Value)
    If CSVP.Status = True Then
        
        sFileName = FileName
        
        MaxRecord = CSVP.RecordCount(MaxField)
        ReDim myArray(MaxRecord, MaxField)
        
        ' Scorro tutte le colonne ed aggiungo la riga con l'intestazione
        For cnt = 0 To MaxField
            myArray(0, cnt) = "Col. " & cnt + 1
        Next
        
        lRows = 1
        While CSVP.LoadNextLine = True
            ' Scorro tutte le colonne
            For lColumns = 1 To CSVP.FieldCount
                myArray(lRows, lColumns - 1) = CSVP.GetField(lColumns)
            Next
            lRows = lRows + 1
        Wend
        
        If lRows > 0 Then
            arrListViewVuoto = False
        Else
            arrListViewVuoto = True
        End If
    Else
        MsgBox CSVP.GetErrorMessage, vbInformation, App.ProductName
    End If

    Set CSVP = Nothing
    
    arrListView() = myArray()
    
    If arrListViewVuoto = False Then
        
        ' Preparo le colonne della ListView
        cmbCsv.Clear
        For cntCol = 1 To UBound(arrListView, 2) + 2
            With ListView1
                If cntCol > 1 Then
                    
                    strTmp = " " & cntCol - 1 & " Col."
                    
                    If cntCol < ListViewDest.ColumnHeaders.Count Then
                        cmbCsv.AddItem ListViewDest.ColumnHeaders(cntCol)
                        .ColumnHeaders.Add , "x" & cntCol, ListViewDest.ColumnHeaders(cntCol)
                    Else
                        cmbCsv.AddItem strTmp
                        .ColumnHeaders.Add , "x" & cntCol, strTmp
                    End If
                
                Else
                    .ColumnHeaders.Add , "x" & cntCol
                End If
                
                .ColumnHeaders.Item(cntCol).Width = 1200
            
            End With
        
        Next
        BloccaComboBox cmbCsv
        cmbCsv.ListIndex = 0
        Call AutoSizeUltimaColonna(ListView1)
            
        ' Scrivo i dati nella ListView1
        For cnt = 0 To UBound(arrListView, 1)
            If cnt = 0 Then
                'Salto la prima riga
                
            Else
                cntCol = 0
                ' Aggiungo la riga con la prima colonna. Creo il numero per l'intestazione della riga
                Set itmX = ListView1.ListItems.Add(, , Format(cntRecord + 1, "00000"))
              
                ' Scrivo i dati nelle colonne
                For cntCol = 1 To UBound(arrListView, 2) + 1
                    ' Scrivo i dati nelle altre colonne
                      If arrListView(cnt, cntCol - 1) = "" Then
                          itmX.SubItems(cntCol) = ""
                      Else
                          itmX.SubItems(cntCol) = arrListView(cnt, cntCol - 1)
                      End If
                Next
                cntRecord = cntRecord + 1
            End If
        Next
        
        Call AutoSizeColonne(ListView1, , , 1200)
        
    Else
        cmdImporta.Enabled = False
        txtCommaSep.SetFocus
        
    End If
    
    GoTo Esci

Errore:
    GestErr Err, "Errore nella funzione frmImporta.CaricaArray."
    
Esci:
    If ListView1.ListItems.Count > 0 Then

        ' Sposto la prima colonna all'ultimo posto
        If ckNumRiga.Value = 1 Then
            SpostaColonna ListView1, 1, ListView1.ColumnHeaders.Count - 1
        End If
        Call SetCeckedListView(ListView1, False, True)
        modSalvaColl (True)
        cmdImporta.Enabled = True
    Else
        modSalvaColl (False)
        cmdImporta.Enabled = False
    End If
    
    LockWindowUpdate 0&
    Screen.MousePointer = vbDefault

End Sub

Private Sub Form_Resize()
    On Error Resume Next
    
    With pctImpostazioni
        .Move (Me.ScaleWidth - .Width) / 2, Me.ScaleHeight - .Height, .Width
    End With
    
    With ListView1
        .Move 0, 0, Me.ScaleWidth, Me.ScaleHeight - pctImpostazioni.Height
    End With
    
    With txtPreview
        .Move 0, 0, Me.ScaleWidth, Me.ScaleHeight - pctImpostazioni.Height
    End With
        
End Sub

Private Sub Form_Unload(Cancel As Integer)
    FormMadre.SetFocus
End Sub

Private Sub txtCommaSep_Change()
    If Len(txtCommaSep.Text) > 2 Then
        txtCommaSep.Text = Right$(txtCommaSep.Text, 2)
        txtCommaSep.SelStart = Len(txtCommaSep)
    End If
End Sub

Private Sub txtCommaSep_GotFocus()
    txtCommaSep.BackColor = vbYellow
End Sub

Private Sub txtCommaSep_LostFocus()
    txtCommaSep.BackColor = vbWhite
    lVar(CommaSep) = txtCommaSep.Text
End Sub
